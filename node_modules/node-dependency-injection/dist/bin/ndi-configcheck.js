#! /usr/bin/env node
'use strict';

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _commander = require('commander');

var _commander2 = _interopRequireDefault(_commander);

var _lib = require('../lib/');

var _JsAdapter = require('./Services/File/JsAdapter');

var _JsAdapter2 = _interopRequireDefault(_JsAdapter);

var _JsonAdapter = require('./Services/File/JsonAdapter');

var _JsonAdapter2 = _interopRequireDefault(_JsonAdapter);

var _JsFileLoader = require('../lib/Loader/JsFileLoader');

var _JsFileLoader2 = _interopRequireDefault(_JsFileLoader);

var _JsonFileLoader = require('../lib/Loader/JsonFileLoader');

var _JsonFileLoader2 = _interopRequireDefault(_JsonFileLoader);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_commander2.default.arguments('<path>').action(function (dir) {
  var container = new _lib.ContainerBuilder();
  dir = _path2.default.isAbsolute(dir) ? dir : _path2.default.join(process.cwd(), dir);
  var loader = void 0;

  switch (_path2.default.extname(dir)) {
    case _JsAdapter2.default.FORMAT:
      loader = new _JsFileLoader2.default(container);
      break;
    case _JsonAdapter2.default.FORMAT:
      loader = new _JsonFileLoader2.default(container);
      break;
    default:
      loader = new _lib.YamlFileLoader(container);
  }

  console.info(_chalk2.default.blue('Checking ' + dir + '...\n'));

  try {
    loader.load(dir);
    console.info(_chalk2.default.green('Configuration file ' + dir + ' is valid'));
    process.exit(0);
  } catch (e) {
    console.info(_chalk2.default.bold.red('ERROR! ' + e.message));
    process.exit(1);
  }
}).parse(process.argv);

if (!process.argv.slice(2).length) {
  _commander2.default.outputHelp(function (helpText) {
    return _chalk2.default.bold.red(helpText);
  });
}